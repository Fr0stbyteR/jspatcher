{"version":3,"file":"js/d8a34aa44bb66e255a13.js","mappings":"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","sources":["webpack://JSPatcher/./src/core/objects/faust/Diagram.scss","webpack://JSPatcher/./src/core/objects/faust/Diagram.ts","webpack://JSPatcher/./src/core/objects/faust/faustCompiler.ts","webpack://JSPatcher/./src/core/objects/faust/faustUI.ts","webpack://JSPatcher/./src/core/objects/faust/index.jspatpkg.ts","webpack://JSPatcher/./src/core/objects/faust/Diagram.scss?56d3"],"sourcesContent":["// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../../node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \".patcher div.box-ui > div.package-faust-diagram > div > div > svg {\\n  height: 100%;\\n  width: 100%;\\n}\", \"\",{\"version\":3,\"sources\":[\"webpack://./src/core/objects/faust/Diagram.scss\"],\"names\":[],\"mappings\":\"AACI;EACI,YAAA;EACA,WAAA;AAAR\",\"sourcesContent\":[\".patcher div.box-ui > div.package-faust-diagram {\\n    & > div > div > svg {\\n        height: 100%;\\n        width: 100%;\\n    }\\n}\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","import BaseObject from \"../base/BaseObject\";\nimport Bang, { isBang } from \"../base/Bang\";\nimport DOMUI, { DOMUIState } from \"../base/DOMUI\";\nimport type Env from \"../../Env\";\nimport type { IInletsMeta, IOutletsMeta } from \"../base/AbstractObject\";\nimport type { FaustNodeInternalState } from \"./FaustNode\";\nimport \"./Diagram.scss\";\n\nexport default class diagram extends BaseObject<{}, {}, [Bang | string | FaustNodeInternalState[\"node\"]], [Record<string, string>], [], {}, DOMUIState> {\n    static package = \"Faust\";\n    static description = \"Get Faust code diagram\";\n    static inlets: IInletsMeta = [{\n        isHot: true,\n        type: \"string\",\n        description: \"Code or FaustNode to compile, bang to output only\"\n    }];\n    static outlets: IOutletsMeta = [{\n        type: \"string\",\n        description: \"SVG file - SVG code pairs\"\n    }];\n    static UI = class extends DOMUI<diagram> {\n        state: DOMUIState = { ...this.state, children: this.props.object._.container ? [this.props.object._.container] : [] };\n    };\n    _ = { svgs: {} as Record<string, string>, container: undefined as HTMLDivElement };\n    subscribe() {\n        super.subscribe();\n        this.on(\"preInit\", () => {\n            this.inlets = 1;\n            this.outlets = 1;\n        });\n        this.on(\"inlet\", async ({ data, inlet }) => {\n            const faustCompiler = await (this.env as Env).getFaustCompiler();\n            const faustSvgDiagrams = new (this.env as Env).Faust.FaustSvgDiagrams(faustCompiler);\n            if (inlet === 0) {\n                if (!isBang(data)) {\n                    try {\n                        this._.svgs = faustSvgDiagrams.from(\"FaustDSP\", typeof data === \"string\" ? data : data.dspCode, \"\");\n                    } catch (e) {\n                        this.error(e);\n                        return;\n                    }\n                }\n                if (this._.svgs) {\n                    this.outlet(0, this._.svgs);\n                    const template = document.createElement(\"template\");\n                    const container = document.createElement(\"div\");\n                    template.appendChild(container);\n                    const mountSvg = (svgStr: string) => {\n                        container.innerHTML = svgStr;\n                        container.querySelectorAll(\".link\").forEach((e: HTMLElement) => {\n                            if (!e.onclick) return;\n                            const fileName = e.onclick.toString().match(/'.+\\/(.+)'/)[1];\n                            e.onclick = () => mountSvg(this._.svgs[fileName]);\n                        });\n                    };\n                    mountSvg(this._.svgs[\"process.svg\"]);\n                    this._.container = container;\n                    this.updateUI({ children: [container] });\n                }\n            }\n        });\n    }\n}\n","import type { FaustCompiler } from \"@shren/faustwasm/dist/esm\";\nimport Bang, { isBang } from \"../base/Bang\";\nimport type { IInletsMeta, IOutletsMeta } from \"../base/AbstractObject\";\n\nimport DefaultObject from \"../base/DefaultObject\";\n\nexport default class faustCompiler extends DefaultObject<{}, {}, [Bang], [FaustCompiler]> {\n    static package = \"Faust\";\n    static description = \"Get FaustCompiler instance\";\n    static inlets: IInletsMeta = [{\n        isHot: true,\n        type: \"bang\",\n        description: \"Output FaustCompiler instance\"\n    }];\n    static outlets: IOutletsMeta = [{\n        type: \"object\",\n        description: \"FaustCompiler instance\"\n    }];\n    state = {};\n    subscribe() {\n        super.subscribe();\n        this.on(\"preInit\", () => {\n            this.inlets = 1;\n            this.outlets = 1;\n        });\n        this.on(\"inlet\", async ({ data, inlet }) => {\n            if (inlet === 0) {\n                if (isBang(data)) this.outlet(0, await this.env.getFaustCompiler());\n            }\n        });\n    }\n}\n","import type { FaustAudioWorkletNode } from \"@shren/faustwasm/dist/esm\";\nimport type { FaustUI } from \"@shren/faust-ui\";\nimport DOMUI, { DOMUIState } from \"../base/DOMUI\";\nimport BaseObject from \"../base/BaseObject\";\nimport type { IInletsMeta, IOutletsMeta } from \"../base/AbstractObject\";\n\ninterface IS {\n    node: FaustAudioWorkletNode;\n    faustUI: FaustUI;\n    root: HTMLDivElement;\n}\n\nexport default class ui extends BaseObject<{}, {}, [FaustAudioWorkletNode], [Record<string, number>], [], {}, DOMUIState> {\n    static package = \"faust\";\n    static description = \"Display a Faust UI\";\n    static inlets: IInletsMeta = [{\n        isHot: false,\n        type: \"object\",\n        description: \"Compiled Faust AudioWorkletNode\"\n    }];\n    static outlets: IOutletsMeta = [{\n        type: \"object\",\n        description: \"Changed parameter name-value map\"\n    }];\n    static UI = class extends DOMUI<ui> {\n        state: DOMUIState = { ...this.state, children: this.props.object._.root ? [this.props.object._.root] : [] };\n        componentDidMount() {\n            super.componentDidMount();\n            this.props.object._.faustUI?.resize();\n        }\n    };\n    _: IS = { node: undefined, faustUI: undefined, root: undefined };\n    subscribe() {\n        super.subscribe();\n        this.on(\"preInit\", () => {\n            this.inlets = 1;\n            this.outlets = 1;\n        });\n        this.on(\"postInit\", () => this.updateUI({ shadow: false }));\n        const handleParamChangedByDSP = (e: CustomEvent<{ path: string; value: number }>) => {\n            this._.faustUI?.paramChangeByDSP(e.detail.path, e.detail.value);\n        };\n        const handleDestroyDSP = (e: CustomEvent<{ target: FaustAudioWorkletNode }>) => {\n            e.detail.target?.removeEventListener(\"paramChanged\", handleParamChangedByDSP);\n            e.detail.target?.removeEventListener(\"destroy\", handleDestroyDSP);\n        };\n        this.on(\"inlet\", async ({ data, inlet }) => {\n            if (inlet === 0) {\n                if (data instanceof AudioWorkletNode) {\n                    this._.node?.removeEventListener(\"paramChanged\", handleParamChangedByDSP);\n                    this._.node?.removeEventListener(\"destroy\", handleDestroyDSP);\n                    this._.node = data;\n                    const ui = data.getUI();\n                    const root = document.createElement(\"div\");\n                    root.style.width = \"100%\";\n                    root.style.height = \"100%\";\n                    root.style.margin = \"0\";\n                    root.style.position = \"absolute\";\n                    root.style.overflow = \"auto\";\n                    root.style.display = \"flex\";\n                    root.style.flexDirection = \"column\";\n                    const { FaustUI } = (await import(\"@shren/faust-ui\"));\n                    const faustUI = new FaustUI({ ui, root, listenWindowMessage: false, listenWindowResize: false });\n                    this._.faustUI = faustUI;\n                    faustUI.paramChangeByUI = (path: string, value: number) => {\n                        this.outlet(0, { [path]: value });\n                    };\n                    if (!data.getOutputParamHandler()) data.setOutputParamHandler((path, value) => data.dispatchEvent(new CustomEvent(\"paramChanged\", { detail: { path, value } })));\n                    data.destroy = () => {\n                        data.dispatchEvent(new CustomEvent(\"destroy\", { detail: { target: data } }));\n                        data.port.postMessage({ type: \"destroy\" });\n                        data.port.close();\n                        data.setOutputParamHandler(null);\n                        data.setPlotHandler(null);\n                    };\n                    data.addEventListener(\"paramChanged\", handleParamChangedByDSP);\n                    data.addEventListener(\"destroy\", handleDestroyDSP);\n                    this.updateUI({ children: [root] });\n                    this._.root = root;\n                    faustUI.resize();\n                }\n            }\n        });\n        this.on(\"destroy\", () => {\n            this._.node?.removeEventListener(\"paramChanged\", handleParamChangedByDSP);\n            this._.node?.removeEventListener(\"destroy\", handleDestroyDSP);\n        });\n        const handleResize = () => {\n            this._.faustUI?.resize();\n        };\n        this.box.on(\"rectChanged\", handleResize);\n        this.box.on(\"presentationRectChanged\", handleResize);\n    }\n}\n","import FaustNode from \"./FaustNode\";\nimport FaustFFT from \"./FaustFFT\";\nimport FaustDataProcessor from \"./FaustDataProcessor\";\nimport diagram from \"./Diagram\";\nimport ui from \"./faustUI\";\nimport faustCompiler from \"./faustCompiler\";\nimport DefaultImporter from \"../importer/DefaultImporter\";\nimport type Env from \"../../Env\";\n\nexport default async (env: Env) => ({\n    \"faust~\": FaustNode,\n    \"faustnode~\": FaustNode,\n    \"faust-data\": FaustDataProcessor,\n    \"faust-fft~\": FaustFFT,\n    diagram,\n    ui,\n    faustCompiler,\n    ...DefaultImporter.import(\"faust\", { ...env.Faust })\n});\n","\n      import API from \"!../../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n      import domAPI from \"!../../../../node_modules/style-loader/dist/runtime/styleDomAPI.js\";\n      import insertFn from \"!../../../../node_modules/style-loader/dist/runtime/insertBySelector.js\";\n      import setAttributes from \"!../../../../node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js\";\n      import insertStyleElement from \"!../../../../node_modules/style-loader/dist/runtime/insertStyleElement.js\";\n      import styleTagTransformFn from \"!../../../../node_modules/style-loader/dist/runtime/styleTagTransform.js\";\n      import content, * as namedExport from \"!!../../../../node_modules/css-loader/dist/cjs.js!../../../../node_modules/sass-loader/dist/cjs.js!./Diagram.scss\";\n      \n      \n\nvar options = {};\n\noptions.styleTagTransform = styleTagTransformFn;\noptions.setAttributes = setAttributes;\n\n      options.insert = insertFn.bind(null, \"head\");\n    \noptions.domAPI = domAPI;\noptions.insertStyleElement = insertStyleElement;\n\nvar update = API(content, options);\n\n\n\nexport * from \"!!../../../../node_modules/css-loader/dist/cjs.js!../../../../node_modules/sass-loader/dist/cjs.js!./Diagram.scss\";\n       export default content && content.locals ? content.locals : undefined;\n"],"names":["ui"],"sourceRoot":""}